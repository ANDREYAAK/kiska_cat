# –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

‚úÖ **–ì–∏–±—Ä–∏–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π:**
- –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (IndexedDB) - –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –°–µ—Ä–≤–µ—Ä–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (PostgreSQL) - –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏

‚úÖ **–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:**
- AuthManager –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ë–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç **—Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ** –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –î–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 2. –° –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π (–∫–æ–≥–¥–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è **–¥—É–±–ª–∏—Ä—É—é—Ç—Å—è** –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
VITE_API_URL=https://api.–≤–∞—à-—Å–µ—Ä–≤–µ—Ä.com
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—ã–π API

–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–µ—Ä–≤–µ—Ä–∞ (Node.js + Express + PostgreSQL):

```javascript
// server/routes/auth.js
app.post('/api/auth/register', async (req, res) => {
  const { email, password, username } = req.body;
  
  // –•–µ—à–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å
  const hashedPassword = await bcrypt.hash(password, 10);
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
  const result = await db.query(
    'INSERT INTO users (email, password_hash, username) VALUES ($1, $2, $3) RETURNING id, email, username',
    [email, hashedPassword, username]
  );
  
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º JWT —Ç–æ–∫–µ–Ω
  const token = jwt.sign({ userId: result.rows[0].id }, SECRET_KEY);
  
  res.json({ 
    success: true, 
    user: result.rows[0], 
    token 
  });
});

app.post('/api/auth/login', async (req, res) => {
  const { email, password } = req.body;
  
  // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const user = await db.query('SELECT * FROM users WHERE email = $1', [email]);
  if (!user.rows[0]) {
    return res.status(401).json({ success: false, error: '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å' });
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–æ–ª—å
  const valid = await bcrypt.compare(password, user.rows[0].password_hash);
  if (!valid) {
    return res.status(401).json({ success: false, error: '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å' });
  }
  
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω
  const token = jwt.sign({ userId: user.rows[0].id }, SECRET_KEY);
  
  res.json({ 
    success: true, 
    user: { id: user.rows[0].id, email: user.rows[0].email, username: user.rows[0].username },
    token 
  });
});
```

```javascript
// server/routes/saves.js
const authenticateToken = (req, res, next) => {
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1];
  
  if (!token) {
    return res.status(401).json({ error: '–¢–æ–∫–µ–Ω –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω' });
  }
  
  jwt.verify(token, SECRET_KEY, (err, user) => {
    if (err) return res.status(403).json({ error: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω' });
    req.user = user;
    next();
  });
};

app.put('/api/:userId/saves/:slotId', authenticateToken, async (req, res) => {
  const { userId, slotId } = req.params;
  const saveData = req.body;
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
  if (req.user.userId !== userId) {
    return res.status(403).json({ error: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω' });
  }
  
  await db.query(
    `INSERT INTO saves (user_id, slot_id, data, updated_at) 
     VALUES ($1, $2, $3, NOW()) 
     ON CONFLICT (user_id, slot_id) 
     DO UPDATE SET data = $3, updated_at = NOW()`,
    [userId, slotId, JSON.stringify(saveData)]
  );
  
  res.json({ success: true });
});

app.get('/api/:userId/saves/:slotId', authenticateToken, async (req, res) => {
  const { userId, slotId } = req.params;
  
  if (req.user.userId !== userId) {
    return res.status(403).json({ error: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω' });
  }
  
  const result = await db.query(
    'SELECT data FROM saves WHERE user_id = $1 AND slot_id = $2',
    [userId, slotId]
  );
  
  if (result.rows.length === 0) {
    return res.status(404).json({ error: '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' });
  }
  
  res.json(result.rows[0].data);
});

app.get('/api/:userId/saves', authenticateToken, async (req, res) => {
  const { userId } = req.params;
  
  if (req.user.userId !== userId) {
    return res.status(403).json({ error: '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω' });
  }
  
  const result = await db.query(
    'SELECT slot_id FROM saves WHERE user_id = $1',
    [userId]
  );
  
  res.json({ keys: result.rows.map(r => r.slot_id) });
});
```

### –®–∞–≥ 3: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î PostgreSQL

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    username VARCHAR(255),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- –¢–∞–±–ª–∏—Ü–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
CREATE TABLE saves (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    slot_id VARCHAR(255) NOT NULL,
    data JSONB NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(user_id, slot_id)
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_saves_user_id ON saves(user_id);
CREATE INDEX idx_saves_slot_id ON saves(user_id, slot_id);
```

### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç—å AuthManager –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Ä–≤–µ—Ä–æ–º

–í `src/core/AuthManager.ts` —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

```typescript
async login(email: string, password: string): Promise<{ success: boolean; error?: string }> {
    try {
        const response = await fetch(`${process.env.VITE_API_URL}/auth/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        
        if (!data.success) {
            return { success: false, error: data.error || "–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏" };
        }
        
        this.state = {
            isAuthenticated: true,
            user: data.user,
            token: data.token
        };
        
        this.notifyAuthChange();
        return { success: true };
    } catch (error) {
        const message = error instanceof Error ? error.message : "–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏";
        return { success: false, error: message };
    }
}
```

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–æ–¥–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```typescript
const authManager = game.getAuthManager();

if (authManager.isAuthenticated()) {
    const userId = authManager.getUserId();
    console.log(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω: ${userId}`);
} else {
    console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω");
}
```

### –í—Ö–æ–¥/–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

```typescript
// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
const result = await authManager.register("user@example.com", "password", "username");
if (result.success) {
    console.log("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!");
}

// –í—Ö–æ–¥
const result = await authManager.login("user@example.com", "password");
if (result.success) {
    console.log("–í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω!");
}
```

### –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```typescript
authManager.onAuthChange((state) => {
    if (state.isAuthenticated) {
        console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à—ë–ª:", state.user);
    } else {
        console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª");
    }
});
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å:**
- –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- –õ–µ–≥–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–æ–¥–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è)

‚úÖ **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å:**
- –õ–æ–∫–∞–ª—å–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞—é—Ç
- –°–µ—Ä–≤–µ—Ä–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è - –±–æ–Ω—É—Å –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:**
- –ì–æ—Ç–æ–≤–æ –¥–ª—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
- –ì–æ—Ç–æ–≤–æ –¥–ª—è –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏
- –ì–æ—Ç–æ–≤–æ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

## –ß—Ç–æ –¥–∞–ª—å—à–µ?

1. **–°–µ–π—á–∞—Å:** –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
2. **–ö–æ–≥–¥–∞ –±—É–¥–µ—Ç —Å–µ—Ä–≤–µ—Ä:** –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å—Ç–µ `VITE_API_URL` –≤ `.env`
3. **UI –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:** –î–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ HUD (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–í—Å—ë –≥–æ—Ç–æ–≤–æ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è! üöÄ
